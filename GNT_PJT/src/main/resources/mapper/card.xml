<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ns.sql.CardMapper">

	<!-- 카드 생성 :: 발급 -->
 	<insert id="insertCard" parameterType="card">
		INSERT
		INTO card(card_id, cvc, background, emo_id, emo_info, font, card_content)
		VALUES (#{cardId}, #{cvc}, #{background}, #{emoId}, #{emoInfo}, #{font}, #{cardContent})
	</insert>
	
	<!-- 카드 연결 :: user id를 알아내서? account 뽑아오기 -->
	<select id="selectAccId" parameterType="string" resultType="string">
		SELECT acc_id
		FROM users
		WHERE user_id=#{value}
	</select>
	
	<!-- 카드 연결 :: accountVO에 담아와서 DB에 추가하기 -->
	<update id="updateCardToAcc" parameterType="account">
		UPDATE account
		SET card_id = #{cardId}
		WHERE acc_id=#{accId}
	</update>

	<!-- 카드 삭제 :: 재발급을 위한 delete  -->
	<delete id="deleteCard" parameterType="string">
		DELETE
		FROM card
		WHERE card_id=#{value}
	</delete>
	
	
	
	
	
	
	<!-- 카드 중복 체크 :: 모든 사람들의 계좌번호 반환 (List<String>) -->
	<select id="selectAccIds" resultType="string">
		SELECT acc_id
		FROM users
	</select>
	
	<!-- 카드 중복 체크 :: 모든 계좌들의 카드번호 반환 (String) -->
	<select id="selectCardId" parameterType="string" resultType="string">
		SELECT card_id
		FROM account
		WHERE acc_id=#{value}
	</select>
	
	
	
	
	
	
	
	<!-- 발급 완료 -->
	<update id="updateCardIssued" parameterType="string">
		UPDATE card
		SET is_issued = '1'
		WHERE card_id=#{value}
	</update>

	<!-- 카드 발급 유무 -->
	<select id="selectCardDelete" parameterType="string" resultType="string">
		SELECT card_id
		FROM account
		WHERE acc_id = #{value}
	
	</select>
	
	
</mapper>